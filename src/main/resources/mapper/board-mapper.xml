<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper SYSTEM "mybatis-3-mapper.dtd">


<mapper namespace="Board">

    <!-- BOARD TABLE Result Map 정의 -->
    <resultMap id="BoardDTO" type="board">
        <id property="seqId" column="SEQ_ID"/>
        <result property="boardTitle" column="BOARD_TITLE"/>
        <result property="boardContents" column="BOARD_CONTENTS"/>
        <result property="boardWriter" column="BOARD_WRITER"/>
        <result property="category" column="CATEGORY"/>
        <result property="boardHits" column="BOARD_HITS"/>
        <result property="fileAttached" column="FILE_ATTACHED"/>
        <result property="createdTime" column="CREATED_TIME"/>
        <result property="updatedTime" column="UPDATED_TIME"/>
    </resultMap>

	<!-- 게시물 저장 후 ID 반환 -->
    <insert id="save" parameterType="board"  useGeneratedKeys="true" keyProperty="seqId">
        INSERT INTO board(BOARD_TITLE, BOARD_WRITER, BOARD_CONTENTS, FILE_ATTACHED, CATEGORY, BOARD_HITS, CREATED_TIME)
            VALUES(#{boardTitle}, #{boardWriter}, #{boardContents}, #{fileAttached}, #{category}, 0, NOW())
    </insert>
    
    <!-- Paging 규칙에 따라 전체 게시물 조회 -->
    <select id="findAll" resultMap="BoardDTO">
        SELECT *
        FROM board
        ORDER BY ${sortColumn} ${sortDirection}
        LIMIT #{limit} OFFSET #{offset}
    </select>
    
    <!-- 전체 데이터 개수 조회 -->
    <select id="count" resultType="long">
        SELECT COUNT(*) FROM board
    </select>
    
    <!-- 특정 게시물 조회 -->
    <select id="findById" parameterType="Long" resultMap="BoardDTO">
        SELECT SEQ_ID, BOARD_TITLE, BOARD_WRITER, BOARD_CONTENTS, BOARD_HITS,
        date_format(CREATED_TIME, "%Y-%m-%d %H:%i:%s") AS CREATED_TIME, FILE_ATTACHED
        FROM board WHERE SEQ_ID=#{seqId}
    </select>
    
    <!-- 특정 게시물 조회 시 HIT+1 -->
    <update id="updateHits" parameterType="Long">
        UPDATE board SET BOARD_HITS=BOARD_HITS+1 WHERE SEQ_ID=#{seqId}
    </update>

	<!-- 특정 게시물 업데이트 -->
    <update id="update" parameterType="board">
        UPDATE board SET BOARD_TITLE=#{boardTitle}, BOARD_CONTENTS=#{boardContents} WHERE SEQ_ID=#{seqId}
    </update>
    
    <delete id="delete" parameterType="Long">
        DELETE from BOARD WHERE SEQ_ID=#{seqId}
    </delete>
    
    
    
    
        
    
    <insert id="insertBoardImage" parameterType="boardImage" useGeneratedKeys="true" keyProperty="id">
        insert into board_image(originalFileName, storedFileName)
            values(#{originalFileName}, #{storedFileName})
    </insert>
    
     <select id="selectBoardImage" parameterType="String" resultType="boardImage">
        select * from board_file where storedFileName = #{storedFileName}
    </select>
</mapper>