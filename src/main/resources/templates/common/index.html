<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
xmlns:sec="http://www.thymeleaf.org" layout:decorate="~{common/layout/layout}">

<head>
<!-- (start) private script -->
<th:block layout:fragment="css">
	<link rel="stylesheet" href="/extensions/aos/aos.css">
	<link rel="stylesheet" href="/extensions/animate/animate.min.css" />
	<link rel="stylesheet" href="/extensions/owlcarousel/owl.carousel.min.css">
	<link rel="stylesheet" href="/extensions/owlcarousel/owl.theme.default.min.css">
</th:block>
<!-- (end) private script -->
</head>

<body>
	<div layout:fragment="contents">
		<div class="row">
			<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
				<div class="carousel-indicators">
					<button type="button" style="border-radius: 50%; width: 10px; height: 10px;" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
					<button type="button" style="border-radius: 50%; width: 10px; height: 10px;" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
					<!--	<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
					<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4"></button> -->
				</div>
				<div class="carousel-inner">
					<div class="carousel-item active">
						<!-- <div class="bg-no-repeat bg-cover bg-50 px-8"
							style="background-image: url(images/kdb/BACKGROUND3.png); background-repeat: no-repeat; background-size: cover; position: relative; height: 40vh;"> -->
						<div class="carousel-img-1">
							<div class="container-md">
								<div class="align-items-center ms-5">
									<div class="col-lg-12 pe-xl-12">
										<div class="row">
											<p class="banner_text mt-5 mb-5">"외부망근태시스템"</p>
										</div>
										<h2 style="color: white;">ePAMS에 오신걸</h2>
										<h2 style="color: white;">진심으로 환영합니다</h2>
										<h2 style="color: white;"></h2>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="carousel-item">
						<!-- <div class="bg-no-repeat bg-cover bg-50 px-8"
							style="background-image: url(images/kdb/BACKGROUND4.png); background-repeat: no-repeat; background-size: cover; position: relative; height: 50vh;"> -->
						<div class="carousel-img-2">
							<div class="container-md">
								<div class="align-items-center ms-5">
									<div class="col-lg-12 pe-xl-12">
										<div class="row">
											<p class="banner_text mt-5 mb-5">"연차 및 저축휴가"</p>
										</div>
										<h2 style="color: white;">언제 어디서든</h2>
										<h2 style="color: white;">편리하게 신청하세요</h2>
										<h2 style="color: white;"></h2>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span> <span class="visually-hidden">Previous</span>
				</button>
				<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span> <span class="visually-hidden">Next</span>
				</button>
			</div>
		</div>

		<!-- end carousel (rolling image) -->
		<div id="main-content">
			<div class="container">
				<div class="row d-flex justify-content-start mb-1">
					<h5 class="text-start">
						<i class="bi bi-stars"></i> 빠른 신청
					</h5>
				</div>
				
				<div class="d-flex justify-content-center">
					<div class="row col-lg-12 col-md-12 d-flex justify-content-center">
						<div class="row col-lg-12 col-md-12 col-sm-12">
							<div class="col-lg-4" style="height: 5rem;">
								<div data-aos="fade-up" data-aos-offset="50" data-aos-easing="ease-out-cubic" data-aos-duration="1000">
									<section class="section">
										<div class="shadow card">
											<div class="card-body align-content-center" style="height: 4rem; padding: 0.8rem;">
												<div class="d-flex justify-content-center">
													<div class="col-10 mb-0 align-content-center">
														<h6 style="margin-bottom: 0;"><span class="badge rounded-pill bg-primary me-1">오늘</span>연차휴가 1일</h6>
														<h7>[[${nowDate}]]</h7>
													</div>
													<div class="col-2 mb-0 align-content-center">
														<div class="d-flex justify-content-end">
															<div class="btn btn-primary btn-sm" style="height: 35px; --bs-btn-padding-y:0.35rem;" th:date="${nowDate}" th:onclick="ApplAlert(this.getAttribute('date'))">신청</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
							<div class="col-lg-4" style="height: 5rem;">
								<div data-aos="fade-up" data-aos-offset="50" data-aos-easing="ease-out-cubic" data-aos-duration="1000">
									<section class="section">
										<div class="shadow card">
											<div class="card-body align-content-center" style="height: 4rem; padding: 0.8rem;">
												<div class="d-flex justify-content-center ">
													<div class="col-10 mb-0 align-content-center">
														<h6 style="margin-bottom: 0;"><span class="badge rounded-pill bg-primary me-1">오늘</span>연차휴가 오전 반차</h6>
														<h7>[[${nowDate}]]</h7>
													</div>
													<div class="col-2 mb-0 align-content-center">
														<div class="d-flex justify-content-end">
															<div class="btn btn-primary btn-sm" style="height: 35px; --bs-btn-padding-y:0.35rem;" th:date="${nowDate}" th:onclick="ApplAlert(this.getAttribute('date'))">신청</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
							<div class="col-lg-4" style="height: 5rem;">
								<div data-aos="fade-up" data-aos-offset="50" data-aos-easing="ease-out-cubic" data-aos-duration="1000">
									<section class="section">
										<div class="shadow card">
											<div class="card-body align-content-center" style="height: 4rem; padding: 0.8rem;">
												<div class="d-flex justify-content-center ">
													<div class="col-10 mb-0 align-content-center">
														<h6 style="margin-bottom: 0;"><span class="badge rounded-pill bg-primary me-1">오늘</span>연차휴가 오전 반반차</h6>
														<h7>[[${nowDate}]]</h7>
													</div>
													<div class="col-2 mb-0 align-content-center">
														<div class="d-flex justify-content-end">
															<div class="btn btn-primary btn-sm" style="height: 35px; --bs-btn-padding-y:0.35rem;" th:date="${nowDate}" th:onclick="ApplAlert(this.getAttribute('date'))">신청</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="d-flex justify-content-center mt-4">
					<div class="row col-lg-12 col-md-12 d-flex justify-content-center">
						<div class="row col-lg-12 col-md-12 col-sm-12">
							<div class="col-lg-4" style="height: 5rem;">
								<div data-aos="fade-up" data-aos-offset="100" data-aos-easing="ease-out-cubic" data-aos-duration="1000">
									<section class="section">
										<div class="shadow card">
											<div class="card-body align-content-center" style="height: 4rem; padding: 0.8rem;">
												<div class="d-flex justify-content-center">
													<div class="col-10 mb-0 align-content-center">
														<h6 style="margin-bottom: 0;"><span class="badge rounded-pill bg-info me-1">내일</span>연차휴가 1일</h6>
														<h7>[[${tomorrowDate}]]</h7>
													</div>
													<div class="col-2 mb-0 align-content-center">
														<div class="d-flex justify-content-end">
															<div class="btn btn-info btn-sm" style="height: 35px; --bs-btn-padding-y:0.35rem;" th:date="${tomorrowDate}" th:onclick="ApplAlert(this.getAttribute('date'))">신청</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
							<div class="col-lg-4" style="height: 5rem;">
								<div data-aos="fade-up" data-aos-offset="100" data-aos-easing="ease-out-cubic" data-aos-duration="1000">
									<section class="section">
										<div class="shadow card">
											<div class="card-body align-content-center" style="height: 4rem; padding: 0.8rem;">
												<div class="d-flex justify-content-center ">
													<div class="col-10 mb-0 align-content-center">
														<h6 style="margin-bottom: 0;"><span class="badge rounded-pill bg-info me-1">내일</span>연차휴가 오전(반차)</h6>
														<h7>[[${tomorrowDate}]]</h7>
													</div>
													<div class="col-2 mb-0 align-content-center">
														<div class="d-flex justify-content-end">
															<div class="btn btn-info btn-sm" style="height: 35px; --bs-btn-padding-y:0.35rem;" th:date="${tomorrowDate}" th:onclick="ApplAlert(this.getAttribute('date'))">신청</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
							<div class="col-lg-4" style="height: 5rem;">
								<div data-aos="fade-up" data-aos-offset="100" data-aos-easing="ease-out-cubic" data-aos-duration="1000">
									<section class="section">
										<div class="shadow card">
											<div class="card-body align-content-center" style="height: 4rem; padding: 0.8rem;">
												<div class="d-flex justify-content-center ">
													<div class="col-10 mb-0 align-content-center">
														<h6 style="margin-bottom: 0;"><span class="badge rounded-pill bg-info me-1">내일</span>연차휴가 오전(반반차)</h6>
														<h7>[[${tomorrowDate}]]</h7>
													</div>
													<div class="col-2 mb-0 align-content-center">
														<div class="d-flex justify-content-end">
															<div class="btn btn-info btn-sm" style="height: 35px; --bs-btn-padding-y:0.35rem;" th:date="${tomorrowDate}" th:onclick="ApplAlert(this.getAttribute('date'))">신청</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				<div class="container">
					<div class="row d-flex justify-content-end">
						<h6 class="text-end">
							직접 신청하러 가기 <i class="bi bi-arrow-right-circle-fill"></i>
						</h6>
					</div>
				</div>
			</div>

		</div>

		<div class="divider">
			<div class="divider-text" style="background-color: transparent;">
				<img class="divider-text" src="/images/kdb/epams_r_cw_action.gif" style="width: 50px; height: 50px; border-radius: 50%; padding: 0;" />
			</div>
		</div>

		<div id="main-content">
			<div class="container">
				<div class="row d-flex justify-content-start mb-2">
					<h5 class="text-start">
						<i class="bi bi-bell-fill"></i> 최근 공지사항
					</h5>
				</div>
				<div class="row d-flex justify-content-center">
					<div class="row col-lg-12">
						<section class="section" th:each="board: ${boardList}">
							<div data-aos="fade-up" class="aos-init aos-animate">
								<div class="shadow card">
									<div class="card-body">
										<a class="card-title" th:href="@{|/board/${board.id}|}"><h6 th:text="${board.boardTitle}"></h6></a>
											<div class="d-flex flex-row mb-3 gap-3">
												<div>
													<i class="bi bi-building"></i>
													<h7 th:text="${board.boardWriter}"></h7>
												</div>
												<div>
													<i class="bi bi-calendar-check"></i>
													<h7 th:text="${#temporals.format(board.boardCreatedTime, 'yyyy-MM-dd')}"></h7>
												</div>
												<div>
													<i class="bi bi-eye"></i>
													<h7 th:text="${board.boardHits}"></h7>
												</div>
											</div>
										<p class="card-text" th:utext="${board.boardContents}"></p>
									</div>
								</div>
							</div>
						</section>
					</div>
				</div>
			</div>


		</div>

		<div class="divider">
			<div class="divider-text" style="background-color: transparent;">
				<img class="divider-text" src="/images/kdb/epams_r_cw_action.gif" style="width: 50px; height: 50px; border-radius: 50%; padding: 0;" />
			</div>
		</div>

		<div id="main-content">
			<div class="container">
				<div class="row d-flex justify-content-start mb-2">
					<h5 class="text-start">
						<i class="bi bi-search"></i> 직원검색
					</h5>
				</div>
			</div>
			<div class="d-flex justify-content-center">

				<div class="row">
					<div class="col-12">
						<div class="shadow card">
							<div class="card-header">
								<h4 class="card-title">담당자가 궁금하신가요?</h4>
							</div>
							<div class="card-content">
								<div class="card-body">
									<p>이름, 팀/부서, 업무명으로 검색하세요</p>
									<div class="row">
										<div class="col-12 mb-1">
											<div class="input-group mb-3">
												<span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i></span> <input type="text" id="searchMember" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username" aria-describedby="button-addon2">
												<button class="btn btn-primary" type="button" id="button-addon2" onclick="search()">조회</button>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="divider">
								<div class="divider-text" style="background-color: transparent;">
									<h5 class="card-title">조회결과</h5>
								</div>

							</div>
							<div class="d-flex justify-content-center">
								<div class="row col-lg-12 col-md-12 col-sm-12">
									<div class="col-12 justify-self-center">
										<div id="memberList"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	
	</div>

	<!-- (start) private script -->
	<th:block layout:fragment="script">
	    <script src="/extensions/webauthn/js/base64js.min.js"></script>
    	<script src="/extensions/webauthn/js/custom.js"></script>
		<script>			
	    
			const search = () => {
				const text = $("#searchMember").val();
			    let header = $("meta[name='_csrf_header']").attr('content');
			    let token = $("meta[name='_csrf']").attr('content');
			    console.log("searchMember :"+text);
			    $.ajax({
			        type: "post",
			        url: "/search",
			        dataType: "json",
			        data: {
			            "text": text
			        },       
			        //CSRF Token
			        beforeSend: function (xhr) {
			        	xhr.setRequestHeader(header, token);
			        },                
			        complete: function(data) {         
						console.log("search reply : " + data.responseText)
						$("#memberList").replaceWith(data.responseText);
				    }
			    });
			}
		</script>
		<script src="/extensions/aos/aos.js"></script>
		<script src="/extensions/owlcarousel/owl.carousel.min.js"></script>
		<script>
			AOS.init({
				easing: 'ease-out-back',
				duration: 1000
			});
		</script>
		
		 <script th:inline="javascript">
			$(document).ready(function() {	
				const simpleauth = [[${simpleauth}]]
				const username = [[${username}]]
				console.log("WebAuthn : "+simpleauth + username);

				if(simpleauth == false) {
				     Swal.fire({
				         title: "간편인증",
				         html: "편리한 로그인을 위해 휴대폰 간편인증을 등록합니다.",
				         inputAttributes: {
				 			autocomplete: 'new-password',
				            autocapitalize: "off",
				            autofocus : "on"
				         },
				         showCancelButton: true,
				         confirmButtonText: "등록",
				         cancelButtonText: "나중에 할게요",
				         showLoaderOnConfirm: true,
				         preConfirm: async () => {},
				         allowOutsideClick: () => !Swal.isLoading()
				     }).then((result) => {
				         if (result.isConfirmed) {
				        	 webauthn_reg(username);
				         }
				     }); //Swal(PW 인증)  
				}
					
			});
			
			function webauthn_reg(username) {
				console.log("In webauthn_reg");
				const header = document.querySelector('meta[name="_csrf_header"]').content;
			    const token = document.querySelector('meta[name="_csrf"]').content;
			    const formData = new FormData();
			    formData.append("username", username);
			    fetch('/webauthn/register', {
			        method: 'POST',
			        headers: {
				        'header': header,
				        'X-CSRF-Token': token,
			    	},
			        body: formData,
			    })
			    .then(response => initialCheckStatus(response))
			    .then(credentialCreateJson => ({
			        publicKey: {
			            ...credentialCreateJson.publicKey,
			            challenge: base64urlToUint8array(credentialCreateJson.publicKey.challenge),
			        user: {
			            ...credentialCreateJson.publicKey.user,
			            id: base64urlToUint8array(credentialCreateJson.publicKey.user.id),
			        },
			        excludeCredentials: credentialCreateJson.publicKey.excludeCredentials.map(credential => ({
			            ...credential,
			            id: base64urlToUint8array(credential.id),
			        })),
			        extensions: credentialCreateJson.publicKey.extensions,
			        },
			    }))
			    .then(credentialCreateOptions =>
			        navigator.credentials.create(credentialCreateOptions))
			    .then(publicKeyCredential => ({
			    	
			        type: publicKeyCredential.type,
			        id: publicKeyCredential.id,
			        response: {
			        attestationObject: uint8arrayToBase64url(publicKeyCredential.response.attestationObject),
			        clientDataJSON: uint8arrayToBase64url(publicKeyCredential.response.clientDataJSON),
			        transports: publicKeyCredential.response.getTransports && publicKeyCredential.response.getTransports() || [],
			        },
			        clientExtensionResults: publicKeyCredential.getClientExtensionResults(),
			    }))
			    .then((encodedResult) => {
			        //const form = document.getElementById("form");
			        //const formData = new FormData(form);
			        console.log("encodedResult : ")
			        formData.append("credential", JSON.stringify(encodedResult));
			        return fetch("/webauthn/finishauth", {
			            method: 'POST',
			        	headers: {
				        'header': header,
				        'X-CSRF-Token': token,
			    	},
			            body: formData,
			        })
			    })
			    .then((response) => {
			        //followRedirect(response);
			    	alert(response);
			    })
			    .catch((error) => {
			        displayError(error);
			    });
			}
		</script>
		<script>
			$(document).ready(function() {
				$(".owl-carousel").owlCarousel({
					items : 4,
					loop : true,
					margin : 10,
					autoplay : true,
					autoplayTimeout : 1000,
					autoplayHoverPause : true
				});
				$('.play').on('click', function() {
					owl.trigger('play.owl.autoplay', [ 1000 ])
				})
				$('.stop').on('click', function() {
					owl.trigger('stop.owl.autoplay')
				})
			});
		</script>
		<script>
			const ApplAlert = (date) => {	
				Swal.fire({
					  title: "신청하시겠습니까?",
					  html: `
					  <p style=\"text-align:center\">${date} 연차 1일</p>
					  
					  <div class="accordion" id="accordionExample">
					  <div class="accordion-item">
					    <h2 class="accordion-header" style="--bs-accordion-btn-focus-box-shadow:;">
					      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
					      <div class="badge text-bg-warning text-wrap me-2" style="width: 3rem;">필독</div><h6 class="mb-0">근태 신청전 유의사항</h6>
					      </button>
					    </h2>
					    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
					      <div class="accordion-body" style="text-align:left;">
						      <div class="row">
					      		<div class="col-1"><i class="bi bi-check-square-fill" style="color:#ffc107;"></i> </div>
					      		<div class="col-11">근태관련 제반 규정을 준수하고, <br><strong>목적외 사용시 어떠한 처벌도 <br>감수</strong>하겠음을 확인합니다. <br><br></div>
				      		  </div>
				      		  <div class="row">
					      		<div class="col-1"><i class="bi bi-check-square-fill" style="color:#ffc107;"></i> </div> 
					      		<div class="col-11"><strong>인장(부/임시 보관책임자), 보안</strong><br>업무에 대해, 업무인수인계를 완료하였음을 확인합니다.<br><br></div>
						      </div>
						      <div class="row">
						        <div class="col-1"><i class="bi bi-check-square-fill" style="color:#ffc107;"></i> </div>
						        <div class="col-11"></i> 위 담당업무외 <strong>중요서류 및 기타<br>사항</strong>에 대하여 업무인수인계를<br>완료하였음을 확인합니다. <br></div>
						      </div>
					      </div>
					    </div>
					  </div>
					  </div>
					  `,
					  icon: "info",
					  showCancelButton: true,
					  scrollbarPadding: false,
					  confirmButtonColor: "#3085d6",
					  cancelButtonColor: "#d33",
					  confirmButtonText: "네, 신청할게요!",
					  cancelButtonText: "아니요",
					}).then((result) => {
					  
					  if (result.isConfirmed) {
					    Swal.fire({
					      title: "신청되었습니다.",
					      html: `<p style=\"text-align:center\">${date} 연차 1일</p>`,
					      icon: "success",
					      confirmButtonColor: "#3085d6",
					      confirmButtonText: "확인"
					    });
					  }
					});
			}
		</script>
	</th:block>
	<!-- (end) private script -->
</body>
</html>