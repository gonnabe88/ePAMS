<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.thymeleaf.org" layout:decorate="~{common/layout/layout}">

<head>
	<!-- (start) private script -->
	<th:block layout:fragment="css">
		<link rel="stylesheet" href="/extensions/litepicker/litepicker.css"/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" />
	</th:block>
	<!-- (end) private script -->
</head>

<body>
<div layout:fragment="contents">
	<div class="container">
		<div id="main-content">
			<div class="d-flex justify-content-center">
				<div class="row col-lg-10 col-md-12 d-flex justify-content-center">
					<div class="page-heading">
						<div class="align-middle">
							<h2>
								<i class="bi bi-bell-fill"></i> 근태조회
							</h2>
							<br>
						</div>
					</div>
					<p class="d-inline-flex justify-content-between">
						<select id="itemsPerPage" class="form-select form-select-sm ms-2 w-auto" aria-label="Items per page">
							<option value="5" selected>5개</option>
							<option value="10">10개</option>
							<option value="20">20개</option>
							<option value="50">50개</option>
						</select>
						<button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="collapse" data-bs-target="#collapseSearch" aria-expanded="false" aria-controls="collapseSearch">
							<i class="bi bi-search"></i>
							검색
						</button>
					</p>
					<div class="collapse" id="collapseSearch">
						<div class="card card-body">
							<div class="card-body p-3">
								<div class="d-flex align-items-center justify-content-between mb-2">
									<h6>결재상태</h6>
									<div class="btn-group btn-group-sm" role="group" aria-label="Basic radio toggle button group">
										<input type="checkbox" class="btn-check" name="statCdList" id="121" autocomplete="off" checked>
										<label class="btn btn-outline-primary" for="121">결재중</label>

										<input type="checkbox" class="btn-check" name="statCdList" id="132" autocomplete="off" checked>
										<label class="btn btn-outline-primary" for="132">결재완료</label>

										<input type="checkbox" class="btn-check" name="statCdList" id="131" autocomplete="off" checked>
										<label class="btn btn-outline-primary" for="131">반려</label>
									</div>
								</div>
							</div>

							<div class="card-body p-3">
								<div class="d-flex align-items-center justify-content-between mb-2">
									<h6>근태종류</h6>
									<div class="btn-group btn-group-sm" role="group" aria-label="DTM Kind Code Select">
										<input type="radio" class="btn-check" name="dtmKindCdSelect" id="dtmKindCd" autocomplete="off" checked>
										<label class="btn btn-outline-primary" for="dtmKindCd">전체</label>

										<input type="radio" class="btn-check" name="dtmKindCdSelect" id="dtmKindCd1" autocomplete="off">
										<label class="btn btn-outline-primary" for="dtmKindCd1">연차</label>

										<input type="radio" class="btn-check" name="dtmKindCdSelect" id="dtmKindCd2" autocomplete="off">
										<label class="btn btn-outline-primary" for="dtmKindCd2">저축</label>

										<input type="radio" class="btn-check" name="dtmKindCdSelect" id="dtmKindCd3" autocomplete="off">
										<label class="btn btn-outline-primary" for="dtmKindCd3">보상</label>
									</div>
								</div>
								<select class="form-control select2" style="width: 100%;" aria-label="DTM Reason Code Select" name="dtmReasonCdSelect" id="dtmReasonCd">
									<option value="" selected>전체</option>
									<option value="1A1">연차휴가</option>
									<option value="1A5">연차휴가 오전(반차)</option>
									<option value="1AG">연차휴가 오전(반반차)</option>
									<option value="1A6">연차휴가 오후(반차)</option>
									<option value="1AH">연차휴가 오후(반반차)</option>
									<option value="1AB">저축휴가</option>
									<option value="1AC">저축휴가 오전(반차)</option>
									<option value="1AI">저축휴가 오전(반반차)</option>
									<option value="1AD">저축휴가 오후(반차)</option>
									<option value="1AJ">저축휴가 오후(반반차)</option>
								</select>
							</div>

							<div class="card-body p-3">
								<h6>근태기간</h6>
								<div class="d-flex align-items-center justify-content-between mb-2">
									<input type="text" class="form-control me-1 start-input" name="start-input" id="start-input" placeholder="YYYY-MM-DD">
									<span>~</span>
									<input type="text" class="form-control ms-1 end-input" name="end-input" id="end-input" placeholder="YYYY-MM-DD">
								</div>
								<div class="d-flex justify-content-center">
									<input type="text" class="form-control start-date" id="start-date" style="display: none;">
									<input type="text" class="form-control end-date" id="end-date" style="display: none;">
								</div>
							</div>

							<div class="d-flex flex-wrap gap-2 justify-content-end align-items-center mb-3">
								<button class="btn btn-primary btn-sm" id="search-button">조회</button>
								<button class="btn btn-primary btn-sm" id="reset-button">초기화</button>
							</div>
						</div>
					</div>

					<!--컨텐츠 목록-->
					<div id="dtmListContainer">
						<div class="row col-lg-12 col-md-12 col-sm-12">
							<div class="col-12">
								<div class="animate__animated animate__fadeIn animate__slow">
									<section class="section" th:each="dtm: ${dtmHis}">
										<div class="card">
											<div class="card-body">
												<div th:switch="${dtm.status}">
                                                    <span th:case="'과거'" class="badge badge-sm mb-4 bg-secondary">
                                                        <span th:text="${dtm.status}"></span>
                                                    </span>
													<span th:case="'예정'" class="badge badge-sm mb-4 bg-primary">
                                                        <span th:text="${dtm.status}"></span>
                                                    </span>
													<span th:case="'진행'" class="badge badge-sm mb-4 bg-warning">
                                                        <span th:text="${dtm.status}"></span>
                                                    </span>
												</div>
												<h6><span th:text="${dtm.dtmReasonNm}"></span></h6>
												<div class="d-flex flex-row align-items-center mt-3 mb-3 gap-3">
													<div class="d-flex align-items-center gap-2">
														<h6>
															<span th:text="${#temporals.format(dtm.staYmd, 'yyyy-MM-dd')}"> </span>
															~
															<span th:text="${#temporals.format(dtm.endYmd, 'yyyy-MM-dd')}"> </span>
														</h6>
													</div>
												</div>
												<div class="d-flex flex-row mb-3 gap-3">
													<div>
														<i class="bi bi-calendar-check"></i>
														<h7 th:text="${#temporals.format(dtm.tzDate, 'yyyy-MM-dd')}"></h7>
													</div>
													<div>
														<i class="bi bi-lightbulb"></i>
														<h7 th:text="${dtm.statCdNm}"></h7>
													</div>
												</div>
											</div>
										</div>
									</section>
								</div>
							</div>
						</div>

						<!-- 페이징처리 시작 -->
						<div th:if="${!dtmHis.isEmpty()}">
							<ul class="pagination justify-content-center align-items-center">
								<!-- Previous button -->
								<li class="page-item" th:classappend="${startPage == 1} ? 'disabled'">
									<a class="page-link" th:href="@{|?page=${startPage - 1}|}" th:if="${startPage > 1}">
										<span><i class="bi bi-caret-left-fill"></i></span>
									</a>
								</li>
								<!-- Page numbers -->
								<li th:each="page : ${#numbers.sequence(startPage, endPage)}"
									th:classappend="${page == dtmHis.number + 1} ? 'active'" class="page-item mx-1">
									<a th:text="${page}" class="page-link" th:href="@{|?page=${page}|}"></a>
								</li>
								<!-- Next button -->
								<li class="page-item" th:classappend="${endPage == dtmHis.totalPages} ? 'disabled'" th:if="${endPage < dtmHis.totalPages}">
									<a class="page-link" th:href="@{|?page=${endPage + 1}|}">
										<span><i class="bi bi-caret-right-fill"></i></span>
									</a>
								</li>
							</ul>
						</div>
						<!-- 페이징처리 끝 -->
					</div>

				</div>
			</div>
		</div>
	</div>
</div>

<!-- (start) private script -->
<th:block layout:fragment="script">
	<script src="/extensions/litepicker/bundle.js"></script>
	<script src="/extensions/litepicker/mobilefriendly.js"></script>
	<script src="/extensions/litepicker/initLitepicker.js"></script>
	<script src="/js/dateInputValidation.js"></script>
	<script src="/js/searchForm.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
	<script>
		$(document).ready(function () {
			// Select2 초기화
			$('#dtmReasonCd').select2();

			// dtmKindCdSelect의 변화 감지
			$('input[name="dtmKindCdSelect"]').on('change', function () {
				const selectedValue = $(this).attr('id');
				let url = "/api/commoncode/code/DTM_REASON_CD";

				if (selectedValue === 'dtmKindCd1') {
					url += "/1A";
				} else if (selectedValue === 'dtmKindCd2') {
					url += "/1B";
				} else if (selectedValue === 'dtmKindCd3') {
					url += "/1Z";
				}

				// AJAX 요청
				$.ajax({
					url: url,
					method: 'GET',
					success: function (data) {
						console.log(data); // 받아온 데이터 출력
						const $select = $('#dtmReasonCd');
						$select.empty(); // 기존 옵션 삭제
						data.forEach(item => {
							$select.append(new Option(item.codeName, item.code)); // 새로운 옵션 추가
						});
						$select.trigger('change'); // 옵션 새로고침
					},
					error: function (xhr, status, error) {
						console.error('Error fetching data: ', error);
					}
				});
			});
		});
	</script>
</th:block>
<!-- (end) private script -->
</body>

</html>
